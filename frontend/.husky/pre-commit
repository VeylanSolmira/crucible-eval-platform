#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

cd frontend

# Security checks before commit
echo "ğŸ”’ Running security checks..."

# 1. Check for vulnerable dependencies
echo "ğŸ“¦ Checking npm dependencies..."
npm audit --audit-level=moderate
if [ $? -ne 0 ]; then
  echo "âŒ Security vulnerabilities found! Run 'npm audit' for details."
  exit 1
fi

# 2. Check for secrets/API keys
echo "ğŸ” Checking for secrets..."
# Check for common patterns
if grep -rE "(api_key|apikey|api-key|secret|password|token)" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" --exclude-dir=node_modules --exclude-dir=.next . | grep -vE "(// |/\*|\.md:|types/api\.ts)"; then
  echo "âŒ Potential secrets found! Review the files above."
  exit 1
fi

# 3. TypeScript type check
echo "ğŸ“ Type checking..."
npm run tsc --noEmit
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript errors found!"
  exit 1
fi

# 4. Lint check
echo "ğŸ§¹ Linting..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ Lint errors found!"
  exit 1
fi

echo "âœ… All security checks passed!"
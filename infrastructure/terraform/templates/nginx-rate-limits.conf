# Rate limiting configuration for Nginx
# This file should be included in /etc/nginx/nginx.conf within the http block

# Define rate limiting zones
# $binary_remote_addr = client IP in binary format (more efficient)
# zone=NAME:SIZE = zone name and memory allocation
# rate=RATE = requests per second/minute/hour

# General rate limit - applies to all requests
limit_req_zone $binary_remote_addr zone=general:10m rate=30r/s;

# Stricter limit for API endpoints
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;

# Very strict limit for authentication endpoints (when implemented)
limit_req_zone $binary_remote_addr zone=auth:10m rate=2r/s;

# Limit for expensive operations (e.g., code execution)
limit_req_zone $binary_remote_addr zone=expensive:10m rate=1r/s;

# Connection limit per IP
limit_conn_zone $binary_remote_addr zone=addr:10m;

# Configure what happens when rate limit is exceeded
limit_req_status 429;
limit_conn_status 429;

# Custom error page for rate limiting
# error_page 429 /429.html;

# Log rate limit violations
limit_req_log_level warn;
limit_conn_log_level warn;